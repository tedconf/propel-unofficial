<!--
-File         $Id: GettingStarted.html,v 1.6 2005/03/24 00:26:41 hlellelid Exp $
-License      GNU FDL (http://www.gnu.org/copyleft/fdl.html)
-Copyright    2003, Propel project
-Author       Hans Lellelid, hans@xmpl.org
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Propel Guide</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="Stylesheet" rev="Stylesheet" href="../css/Documentation.css" type="text/css" charset="iso-8859-1"/>
</head>
<body>

<h1>Początek</h1>

<p>W tym rozdziale przejdziemy po kolei przez wszystkie etapy niezbędne do uruchomienia i użycia dostarczonej z Propelem aplikacji &quot;bookstore&quot;. Zacznijmy od zapoznania się się ze strukturą katalogów, abyśmy wiedzieli, gdzie możemy spodziewać się jakich plików.
</p>
<h2><a name="GettingStarted.Structure"></a>Struktura generatora propel</h2>
<p>Zanim zaczniemy, powinieneś koniecznie zapoznać się ze strukturą katalogów generatora Propel. Na początek zwróć uwagę na katalog <tt>projects/bookstore/</tt>, bo tam znajdują się pliki, które będziesz modyfikował. Dodatkowo, gdy zakończysz proces budowania[build], znajdziesz tam katalog <tt>/projects/bookstore/build/</tt>, który będzie zawierał wygenerowane pliki potrzebne przy tworzeniu aplikacji.
</p>
<pre title="DistributionFileLayout">
propel/generator  
  |-- classes
  |    +-- propel
  |         |-- engine
  |         |    |-- database
  |         |    |    |-- model
  |         |    |    +-- transform
  |         |    +-- sql
  |         +-- phing    
  |-- dtd
  |-- projects
  |    +-- bookstore
  |-- templates
  +-- test
       |-- classes
       |    +-- propel
       +-- etc
</pre>
<p> Poniższa tabela opisuje zawartość najważniejszych katalogów:
</p>
<a name="tables.PropelSourceTreeDirectories"></a> 
<table>
  <caption>
  Drzewo katalogów Propela
  </caption>
  <thead>
    <tr> 
      <th>Katalog</th>
      <th>Zawartość</th>
    </tr>
  </thead>
  <tbody>
    <tr> 
      <td><p>classes</p></td>
      <td><p>Repozytorium wszystkich klas używanych przez Propel. Zawiera też klasy Creole, które dostarczają zunifikowany i lekki interfejs programistyczny dla baz danych (DB API)</p></td>
    </tr>
    <tr> 
      <td><p>dtd</p></td>
      <td> <p>Przechowuje pojedyńczy plik DTD służący do walidacji poprawności plików XML.</p></td>
    </tr>
    <tr> 
      <td><p>projects</p></td>
      <td> <p>Repozytorium wszystkich projektów (każdy katalog, to jeden projekt). Propel czyta pliki schematów (XML) i konfiguracyjne z tego katalogu i zapisuje w nim to, co wygeneruje.</p></td>
    </tr>
    <tr> 
      <td><p>templates</p></td>
      <td> <p>Zawiera pliki szablonów PHP (Capsule), na podstawie których tworzone są pliki zawierające kod SQL oraz modele danych</p></td>
    </tr>
    <tr> 
      <td height="37"><p>test</p></td>
      <td> <p>Testy jednostkowe (PHPUnit2) i skrypt bookstore-test.php, które możesz uruchomić po zakończeniu tego rozdziału[installation exercise]</p></td>
    </tr>
  </tbody>
</table>

<h2><a name="GettingStarted.XMLSchema"></a>Opisywanie bazy danych w XML</h2>
<p>Aby stworzyć klasy, które ściśle będą odpowiadały Twoim tabelom w bazie danych i ich relacjom, musisz dostarczyć propelowi XML, który jest ich reprezentacją. Przeanalizujemy teraz plik <tt>projects/bookstore/schema.xml</tt>, dostarczony razem z Propelem</p>
<p><strong>Uwaga:</strong> Jeśli chcesz użyć Propela z już istniejącą bazą danych, możesz kazać mu wygenerować plik XML przy pomocy klas metadanych Creole. Ciagle jednak będziesz musiał poprawić nieco ten plik (np. zdefiniować, które kolumny mają mieć autoincrement, zmienić nazwy PHP dla kolumn, dodać relacje oparte o klucze obce dla baz, które ich nie wspierają itp.). Zobacz <a href="appendices/AppendixA-PropelOperations.html">DodatekA  - Operacje Propela[zmienic tłumaczenie]</a>, aby dowiedzieć sie więcej.
</p>
<p>Oto fragment pliku <tt>schema.xml</tt>. Jak widzisz, definicje modelu danych są ściśle związane z aktualną strukturą bazy danych (Ciagle dodajemy nowe rzeczy, więc Twoja wersja może się nieco różnić od poniższej)
</p>
<pre title="bookstore-schema.xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; standalone=&quot;no&quot;?&gt;
&lt;database name=&quot;bookstore&quot; defaultIdMethod=&quot;native&quot;&gt;
 &lt;table name=&quot;book&quot; description=&quot;Book Table&quot;&gt;
  &lt;column
    name=&quot;book_id&quot;
    required=&quot;true&quot;
    primaryKey=&quot;true&quot;
    type=&quot;INTEGER&quot;
    description=&quot;Book Id&quot;/&gt;
  &lt;column
    name=&quot;title&quot;
    required=&quot;true&quot;
    type=&quot;VARCHAR&quot;
    size=&quot;255&quot;
    description=&quot;Book Title&quot;/&gt;
  &lt;column
    name=&quot;isbn&quot;
    required=&quot;true&quot;
    type=&quot;VARCHAR&quot;
    size=&quot;24&quot;
    phpName=&quot;ISBN&quot;
    description=&quot;ISBN Number&quot;/&gt;
  &lt;column
    name=&quot;publisher_id&quot;
    required=&quot;true&quot;
    type=&quot;INTEGER&quot;
    description=&quot;Foreign Key Publisher&quot;/&gt;
  &lt;column
    name=&quot;author_id&quot;
    required=&quot;true&quot;
    type=&quot;INTEGER&quot;
    description=&quot;Foreign Key Author&quot;/&gt;
  &lt;foreign-key foreignTable=&quot;publisher&quot;&gt;
   &lt;reference
     local=&quot;publisher_id&quot;
     foreign=&quot;publisher_id&quot;/&gt;
  &lt;/foreign-key&gt;
  &lt;foreign-key foreignTable=&quot;author&quot;&gt;
   &lt;reference
     local=&quot;author_id&quot;
     foreign=&quot;author_id&quot;/&gt;
  &lt;/foreign-key&gt;
 &lt;/table&gt;

 &lt;table name=&quot;publisher&quot; description=&quot;Publisher Table&quot;&gt;
  &lt;column
    name=&quot;publisher_id&quot;
    required=&quot;true&quot;
    primaryKey=&quot;true&quot;
    type=&quot;INTEGER&quot;
    description=&quot;Publisher Id&quot;/&gt;
  &lt;column
    name=&quot;name&quot;
    required=&quot;true&quot;
    type=&quot;VARCHAR&quot;
    size=&quot;128&quot;
    description=&quot;Publisher Name&quot;/&gt;
 &lt;/table&gt;

 &lt;table name=&quot;author&quot; description=&quot;Author Table&quot;&gt;
  &lt;column
    name=&quot;author_id&quot;
    required=&quot;true&quot;
    primaryKey=&quot;true&quot;
    type=&quot;INTEGER&quot;
    description=&quot;Author Id&quot;/&gt;
  &lt;column
    name=&quot;first_name&quot;
    required=&quot;true&quot;
    type=&quot;VARCHAR&quot;
    size=&quot;128&quot;
    description=&quot;First Name&quot;/&gt;
  &lt;column
    name=&quot;last_name&quot;
    required=&quot;true&quot;
    type=&quot;VARCHAR&quot;
    size=&quot;128&quot;
    description=&quot;Last Name&quot;/&gt;
 &lt;/table&gt;
&lt;/database&gt;</pre>
<p>Powyższy XML powinien być zrozumiały, ale przyjrzymy się niektórym atrybutom bardziej szczegółowo. Pełen wykaz atrybutów wraz z wyjaśnieniami znajdziesz w <a href="appendices/AppendixB-SchemaReference.html">DodatkuA - Wyjaśnienie atrybutów[schema reference]</a></p>
<h3>&lt;table idMethod=&quot;&quot; ... &gt;, &lt;database defaultIdMethod=&quot;&quot; 
  ... &gt;</h3>
<p>Element <strong>&lt;table&gt;</strong> wspiera atrybut <strong>idMethod</strong>; Jeśli nie zostanie on zdefiniowany, wówczas zostanie domyślnie wybrany atrybut <strong>defaultIdMethod</strong> elementu <strong>&lt;database&gt;<em> </em></strong>. Poprawnymi wartościami <strong>idMethod</strong> są &quot;native&quot oraz &quot;none&quot. Ustawienie wartości &quot;native&quot spowoduje, że zostanie użyta domyślna metoda generowania ID -- np. autoincrement dla MySQL, czy sequences dla PostgreSQL
</p>
<p><strong>Uwaga:</strong>w Torque jest jeszcze &quot;id-broker&quot;, opcja ta używa tabeli bazy danych do emulowania sekwencji (podobna do emulacji sekwencji z  PEAR::DB albo MDB). Od tego miejsca Propel nie wspiera metody id-broker, bo wszystkie wspierane bazy danych mają wbudowaną obsługę autoincrement lub sequence dla kolumn (mniejsza strata wydajności niż poprzez emulację).
</p>
<h4>&lt;column type=&quot;&quot;&gt;</h4>
<p>Atrybut <strong>type</strong> w tagu <strong>&lt;column&gt;</strong> jest używany do określenia metatypu Propela. Metatypy sa podobne do typów SQL, ale nie nie odpowiadają sobie bezpośrednio. Są to standardowe typy, konwertowane przez Propel do typu najbardziej odpowiadającego Twojej bazie danych (RDBMS).
Na przykład, typ &quot;TIMESTAMP&quot; zostanie zastąpiony przez &quot;DATETIME&quot;  dla bazy MySQL (dlatego, że natywny typ TIMESTAMP w MySQL jest specyficzny i kłopotliwy przy przetwarzaniu). Zobacz rozdział <a href="ColumnTypes.html">Typy Kolumn w Propelu</a> aby uzyskać więcej informacji
</p>
<h4>&lt;column phpName=&quot;&quot; ... /&gt;</h4>
<p>Podczas tworzenia klas, Propel automatycznie &quot;PEAR-uje&quot; nazwy kolumn dla swojego modelu obiektowego. Domyślnie konwertuje podkreślenia &quot;_&quot; w nazwach kolumn do formatu odpowiadającego konwencji nazwniczej PEAR dla metod. Np. <strong>book.my_column_name</strong> da w efekcie metody <strong>Book::getMyColumnName()</strong>, <strong>Book::setMyColumnName()</strong>, itd.
<p>Możesz zastąpić domyślny schemat, ustalając swoje własne nazwy przy pomocy atrybutu <strong>phpName</strong></p>

</p>
<h2><a name="GettingStarted.BuildProps"></a>Konfigurowanie opcji kompilacji</h2>
<p>Należy wyraźnie rozdzielić opcje <em>kompilacji</em> od właściwości <em>uruchomieniowych</em>. Te pierwsze zawierają informacje o projekcie, których Propel potrzebuje aby zbudować (skompilować) klasy i SQL. Nie wszystkie opcje są wymagane: np, Propel nie musi wiedzieć, jak połaczyć się z bazą danych do czasu, gdy nie zechesz, aby stworzył bazę danych lub wyeksportował z niej dane.
</p>
<p>Propel będzie szukał opcji kompilacji w plikach <tt>build.properties</tt> i <tt>default.properties</tt> w swoim katalogu głównym oraz w katalogu projektu, który aktualnie jest kompilowany. <em>Ci, którzy używają Propel z SVN muszą zmienić nazwę pliku <tt>build.properties-sample</tt> na <tt>build.properties</tt>. Możesz chcieć zmienić opcje w tym pliku, ale nie jest to zalecane</em>. Lepiej zmieniać zawartość pliku <tt>build.properties</tt> w katalogu projektu. (np. <tt>projects/bookstore/build.properties</tt>).
Poniżej przykadowy plik <tt>build.properties</tt> projektu:</p>
<pre title="sample build.properties">
# The name of the project 
propel.project = bookstore
 
# The database driver 
propel.database = mssql

# The connection parameters (optional)
propel.database.url = mssql://localhost/bookstore
</pre>

<h2><a name="GettingStarted.RuntimeProps"></a>Właściwości uruchomieniowe</h2>
<p>Właściwości uruchomieniowe najczęsciej są takie same jak podane przy kompilacji właściwości dotyczące połaczeń z bazą danych. Mogą oczywiście być inne.
Aby je zmienić musisz edytować plik <tt>runtime-conf.xml</tt>. Zauważ, że musisz podać te dane w stylu PEAR'a jako tablicę[DSN array], w przeciwieństwie do właściwości kompilacji, gdzie podawałeś je w postaci URL w pliku <tt>build.properties</tt></p>
<pre title="sample bookstore.properties">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;

&lt;config&gt;
 &lt;log&gt;
  &lt;ident&gt;propel-bookstore&lt;/ident&gt;<br />  &lt;level&gt;7&lt;/level&gt;
 &lt;/log&gt;
 &lt;propel&gt;
  &lt;datasources default=&quot;bookstore&quot;&gt;
   &lt;datasource id=&quot;bookstore&quot;&gt;
    &lt;!-- the Propel adapter (usually same as phptype of connection DSN) --&gt;
    &lt;adapter&gt;sqlite&lt;/adapter&gt;
    &lt;connection&gt;
     &lt;phptype&gt;sqlite&lt;/phptype&gt;
     &lt;hostspec&gt;localhost&lt;/hostspec&gt;
     &lt;database&gt;./bookstore.db&lt;/database&gt;
     &lt;username&gt;&lt;/username&gt;
     &lt;password&gt;&lt;/password&gt;
    &lt;/connection&gt;
   &lt;/datasource&gt;
  &lt;/datasources&gt;
 &lt;/propel&gt;
&lt;/config&gt;</pre>
<p>Podczas kompilacji, plik ten zostanie skonwertowany do postaci czystego kodu PHP i jako tablica umieszczony w pliku <tt>projects/bookstore/build/conf/runtime-conf.php</tt>, dzięki czemu nie będzie konieczne każdorazowe parsowanie pliku XML.
Zauważ, że obecnie wygenerowana tablica nie odpowiada ściśle formatowi pliku XML. Dzieje się tak, bo konieczene jest zachowanie wstecznej zgodności ze starym formatem plików .properties</p>
<pre>&lt;?php<br />// This file generated by Propel convert-props target on 09/08/05 20:23:27<br />// from XML runtime conf file .\projects\bookstore\runtime-conf.xml<br />return array (<br />  'log' =&gt; <br />  array (<br />    'ident' =&gt; 'propel-bookstore',<br />    'level' =&gt; '7',<br />  ),<br />  'propel' =&gt; <br />  array (<br />    'datasources' =&gt; <br />    array (<br />      'bookstore' =&gt; <br />      array (<br />        'adapter' =&gt; 'sqlite',<br />        'connection' =&gt; <br />        array (<br />          'phptype' =&gt; 'sqlite',<br />          'hostspec' =&gt; 'localhost',<br />          'database' =&gt; './bookstore.db',<br />          'username' =&gt; '',<br />          'password' =&gt; '',<br />        ),<br />      ),<br />      'default' =&gt; 'bookstore',<br />    ),<br />  ),<br />);</pre>
<p>Klasy Propela mogą teraz czytać informacje z tego pliku z minimalną stratą wydajności.
Później okaże się, że po prostu przekazujesz ścieżkę do tego pliku metodzie <strong>Propel::init()</strong>, aby rozpocząć pracę.</p>
<h2><a name="GettingStarted.Building"></a>Kompilacja</h2>

<p>Propel jest teraz zainstalowany, opcje konfiguracyjne zostały ustawione - jesteś gotowy do rozpoczęcia kompilacji. <em>Proces kompilacji wymaga zainstalowanego i skonfigurowanego <a href="Bibliography.html#bib.phing">Phinga</a></em></p>

<hr/>
  
<h3>Kompilacja dla Propela zinstalowanego przy pomocy PEAR</h3>

<p>Aby skompilować klasy i pliki SQL, uruchom dołączony program o nazwie <tt>propel-gen</tt></p>
<pre title="build propel (Unix)">
$&gt; propel-gen /path/to/bookstore 
</pre>

<p>W systemie windows postępujesz analogicznie:</p>
<pre title="build propel (Windows)">
C:\&gt; propel-gen C:\path\to\bookstore
</pre>

<em>Aplikacja bookstore znajduje się w katalogu <tt>data</tt> znajdującym się w katalogu głównym pakietu PEAR. Jego położenie jest zależne od systemu operacyjnego i ustawień.</em>

<h3>Kompilacja dla Propela zainstalowanego w sposób tradycyjny (lub z SVN):</h3>

<p>Aby skompilować klasy i pliki SQL uruchom program Phing, jako parametr przekazując nazwę projektu (musi znaleźć w katalogu plik <tt>build-propel.xml</tt>)</p>
<pre title="build propel (Unix)">
$&gt; cd /usr/local/propel/generator
$&gt; phing -Dproject=bookstore
</pre>
<p>W systemie Windows operacja wygląda tak samo:</p>
<pre title="build propel (Windows)">
C:\&gt; cd C:\PHP\apps\propel\generator
C:\PHP\apps\propel\generator&gt; phing -Dproject=bookstore
</pre>
<p>[nie podoba mi się tłumaczenie ;| ]
Plik <tt>build.xml</tt> jest wygodną bramą[convinient wrapper] do skryptu <tt>build-propel.xml</tt>, który pozwala używać plików <tt>build.properties</tt> dla każdego z projektów osobno. Jeśli jednak chcesz użyć skryptu <tt>build-propel.xml</tt> bezpośrednio, upewnij się, że wszystkie właściwości projektu są wyszczególnione na początku pliku <tt>build.properties</tt>[chyba raczej chodzi o dziedziczenie poziomów ;/]</p>

<hr/>
  
<p>Zaczyna się proces kompilacji, podczas którego generowane są pliki SQL oraz klasy. Wszystko to na podstawie omówionych wcześniej plików schematów XML z katalogu <tt>projects/bookstore/</tt> -  w tym przypadku jest to jeden plik <tt>schema.xml</tt></p>
<p>Wynik kompilacji zostanie umieszczony w katalogu <tt>projects/bookstore/<strong>build</strong></tt></p>
  
<p>Na ekranie powinieneś zobaczyć coś <em>podobnego</em> jak poniżej (inne będą ścieżki i inne ustawienia, w zależności od wersji Propela i instalatora Phing):</p>

<pre title="build output">
C:\sandbox\propel-generator>phing -Dproject=bookstore
Buildfile: C:\sandbox\propel\generator\build.xml

propel-project-builder &gt; projectcheck:

propel-project-builder &gt; main:
    [phing] Calling Buildfile 'C:\sandbox\propel\generator\build-propel.xml' wit
h target 'main'

propel &gt; main:
[phingcall] Calling Buildfile 'C:\sandbox\propel\generator\build-propel.xml' wit
h target 'sql'

propel &gt; check-run-only-on-schema-change:

propel &gt; sql-check:

propel &gt; sql:
     [echo] +------------------------------------------+
     [echo] |                                          |
     [echo] | Generating SQL for YOUR Propel project!  |
     [echo] |                                          |
     [echo] +------------------------------------------+
[phingcall] Calling Buildfile 'C:\sandbox\propel\generator\build-propel.xml' wit
h target 'sql-template'

propel &gt; sql-template:
[propel-sql] Processing: schema.xml
[propel-sql] Target database type: sqlite
[propel-sql] Target package:
[propel-sql] Using template path: C:\sandbox\propel\generator\templates
[propel-sql] Output directory: C:\sandbox\propel\generator\projects\bookstore\bu
ild\sql
[propel-sql] Generating SQL tables for database: bookstore
[propel-sql] Writing to SQL file: C:\sandbox\propel\generator\projects\bookstore
\build\sql\schema.sql
[propel-sql]     + book
[propel-sql]     + publisher
[propel-sql]     + author
[propel-sql]     + review
[propel-sql]     + media
[phingcall] Calling Buildfile 'C:\sandbox\propel\generator\build-propel.xml' wit
h target 'om'

propel &gt; check-run-only-on-schema-change:

propel &gt; om-check:

propel &gt; om:
     [echo] +------------------------------------------+
     [echo] |                                          |
     [echo] | Generating Peer-based Object Model for   |
     [echo] | YOUR Propel project!                     |
     [echo] |                                          |
     [echo] +------------------------------------------+
[phingcall] Calling Buildfile 'C:\sandbox\propel\generator\build-propel.xml' wit
h target 'om-template'

propel &gt; om-template:
[propel-om] Target database type: sqlite
[propel-om] Target package: bookstore
[propel-om] Using template path: C:\sandbox\propel-generator\templates
[propel-om] Output directory: C:\sandbox\propel\generator\projects\bookstore\bui
ld\classes
[propel-om] Processing: schema.xml
[propel-om] Processing Datamodel : schema.xml
[propel-om]   - processing database : bookstore
[propel-om]     + book
[propel-om]             -&gt; BaseBookPeer
[propel-om]             -&gt; BaseBook
[propel-om]             -&gt; BookMapBuilder
[propel-om]             -&gt; BookPeer
[propel-om]             -&gt; Book
[propel-om]     + publisher
[propel-om]             -&gt; BasePublisherPeer
[propel-om]             -&gt; BasePublisher
[propel-om]             -&gt; PublisherMapBuilder
[propel-om]             -&gt; PublisherPeer
[propel-om]             -&gt; Publisher
[propel-om]     + author
[propel-om]             -&gt; BaseAuthorPeer
[propel-om]             -&gt; BaseAuthor
[propel-om]             -&gt; AuthorMapBuilder
[propel-om]             -&gt; AuthorPeer
[propel-om]             -&gt; Author
[propel-om]     + review
[propel-om]             -&gt; BaseReviewPeer
[propel-om]             -&gt; BaseReview
[propel-om]             -&gt; ReviewMapBuilder
[propel-om]             -&gt; ReviewPeer
[propel-om]             -&gt; Review
[propel-om]     + media
[propel-om]             -&gt; BaseMediaPeer
[propel-om]             -&gt; BaseMedia
[propel-om]             -&gt; MediaMapBuilder
[propel-om]             -&gt; MediaPeer
[propel-om]             -&gt; Media
[phingcall] Calling Buildfile 'C:\sandbox\propel\generator\build-propel.xml' wit
h target 'convert-props'

propel &gt; convert-props:
     [echo] +------------------------------------------+
     [echo] |                                          |
     [echo] | Converting project properties file to an |
     [echo] | array dump for run-time performance.     |
     [echo] |                                          |
     [echo] +------------------------------------------+
  [capsule] Using templatePath: C:\sandbox\propel\generator\templates
  [capsule] Generating to file C:\sandbox\propel\generator\projects\bookstore\bu
ild\conf\bookstore-conf.php
  [capsule] Parsing control template: conf/Control.tpl

BUILD FINISHED

Total time: 5.9279 seconds
</pre>
<p><strong>Uwaga:</strong> Jeśli napotkasz jakieś błędy, spróbuj dodać opcje <em>-verbose</em> lub <em>-debug</em>, aby otrzymać więcej informacji o procesie kompilacji od generatora. </p>
<h2><a name="GettingStarted.UsingSQL"></a>Użycie plików SQL</h2>
<p>Definicje SQL wygenerowane przez Propel znajdziesz w pliku <tt>projects/bookstore/build/schema.sql</tt>. Plik ten zawiera kod SQL służący do stworzenia tabel i innych obiektów w utworzonej bazie danych. Możesz użyć polecenia &quot;create-db&quot; aby utworzyć tą bazę danych, ale niektóre bazy jak np. MS SQL Server nie wspierają tego.</p>
<p>Np. Aby stworzyć i wypełnić (tabelami) bazę MySQL użyj tego kodu:</p>
<pre title="manual db creation">% mysqladmin -u root create bookstore
% mysql -u root bookstore &lt; projects/bookstore/build/sql/schema.sql</pre>
<p>To samo może też zrobić dla Ciebie Propel/Phing:</p>
<pre title="propel db creation">% phing -Dproject=bookstore -Dtarget=create-db
% phing -Dproject=bookstore -Dtarget=insert-sql</pre>
<h2><a name="GettingStarted.UsingOM"></a>Używanie Modelu Obiektowego</h2>
<p>Teraz nastąpi najciekawsza część -- jak użyć tych klas w Twojej aplikacji PHP? Klasy zostały zapisane w katalogu <tt>build/classes/bookstore</tt>. Powinieneś dodać ten katalog do zestawu ścieżek, z kŧórych można dołączyć klasy w twojej aplikacji, lub przenieść go (<tt>build/classes/bookstore </tt>)
do innej lokacji. </p>
<p>Aby zademonstrować przyjmijmy, że dysponujesz systemem unixowym (np. Linux) i posiadasz katalog <tt>/var/www/bookstore_app/classes</tt> ustawiony w dyrektywie include_path swojego PHP:</p>
<pre title="build propel (Unix)">
$&gt; cd /usr/local/propel/generator
$&gt; mv projects/bookstore/build/classes/bookstore /var/www/bookstore_app/classes</pre>
<p>W systemie Windows, możesz po prostu użyć myszki do skopiowania tego katalogu :)</p>
<p>Teraz możesz też przenieść plik ze &quot;skompilowanymi&quot; właściwościami projektu np.</p>
<pre title="build propel (Unix)">$&gt; mv projects/bookstore/conf/runtime-conf.php /var/www/bookstore_app/conf/</pre>
<p>W Windows jak zwykle... click... drag... drop... :).</p>
<p>Teraz zainicjujmy Propel i dołączmy potrzebne klasy. Możemy już zacząć mysleć nad poważniejszymi sprawami:</p>
<pre title="sample use">&lt;?php

// Inicjalizujemy Propel używając ścieżki do stworzonego przez phing convert-props pliku z właściwościami
require_once 'propel/Propel.php';
Propel::init('/var/www/bookstore_app/conf/runtime-conf.php');

// Pliki te znajdują się w katalogu build/classes Twojego prokectu, więc
// powinien on zostac wcześniej dodany do include_path
include_once 'bookstore/Author.php';
include_once 'bookstore/Publisher.php';
include_once 'bookstore/Book.php';

$author = new Author();
$author-&gt;setFirstName(&quot;Leo&quot;);
$author-&gt;setLastName(&quot;Tolstoy&quot;);

$pub = new Publisher();
$pub-&gt;setName(&quot;Viking Press&quot;);

$book = new Book();
$book-&gt;setTitle(&quot;War &amp; Peace&quot;);
$book-&gt;setIsbn(&quot;0140444173&quot;);
$book-&gt;setPublisher($pub);
$book-&gt;setAuthor($author);

// Zapisujemy (w tym wypadku wykonujemy operację insert) nowy obiekt
$book-&gt;save(); 

// $book-&gt;save() automatycznie wywoła $author-&gt;save()
//  i $publisher-&gt;save() ponieważ tych obiektów do tej pory nie było w bazie.

// -------------------------------------

// Teraz znajdźmy tą książkę!

// Klasy &quot;peer&quot; - są to statyczne klasy obsługujące np. zapytania.
$c = new Criteria();
$c-&gt;add(BookPeer::TITLE, &quot;War%&quot;, Criteria::LIKE);
$c-&gt;setLimit(10); // just in case we keep running this script :) [{???????}]

$books = BookPeer::doSelect($c);

if ($books) {
  print &quot;&lt;p&gt;&lt;strong&gt;Found books!&lt;/strong&gt;&lt;/p&gt;&quot;;


  foreach($books as $book) {
    print &quot;&lt;br/&gt;&quot; . $book-&gt;getTitle() . &quot;, by &quot; . 
          $book-&gt;getAuthor()-&gt;getFirstName();<br />  }
} else {
  print &quot;&lt;p&gt;&lt;strong&gt;Did NOT find books!&lt;/strong&gt;&lt;/p&gt;&quot;;
} 
?&gt;</pre>
<p>Mam nadzieję, że opanowałeś podstawy generowania i używania klas Propela.
W następnych rozdziałach skupimy się na nieco bardziej skomplikowanych i częstszych problemach. Zobaczymy jak Propel nawet bardzo skomplikowane zadania czyni bardzo prostymi.</p>

</body>
</html>
