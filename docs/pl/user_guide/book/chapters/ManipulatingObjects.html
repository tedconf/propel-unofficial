<!--
-File         $Id: ManipulatingObjects.html,v 1.1 2004/07/08 01:17:06 hlellelid Exp $
-License      GNU FDL (http://www.gnu.org/copyleft/fdl.html)
-Copyright    2003, Propel project
-Author       Hans Lellelid, hans@xmpl.org
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Propel Guide</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="Stylesheet" rev="Stylesheet" href="../css/Documentation.css" type="text/css" charset="iso-8859-1"/>
</head>
<body>

<h1>Manipulowanie Obiektami</h1>

<p>W tym rozdziale przyjrzymy się dodawaniu, aktualizowaniu i usuwaniu obiektów z dazy danych.</p>

<h2><a name="ManipulatingObjects.Inserting"></a>Dodawanie obiektów</h2>

<h3>Proste wstawianie (insert)</h3>
<p>Dodawanie obiektów do bazy danych jest po prostu wstawianiem wierszy do tabeli. Jest to bardzo proste do wykonania w Propelu poprzez stworzenie nowej instancji odpowiedniej klasy i wywołanie jej metody <strong>save()</strong>.</p>

<pre title="retrieveByPk() simple key">// Stwórz nowego Autora
$author = new Author();
$author-&gt;setFirstName(&quot;Leo&quot;);
$author-&gt;setLastName(&quot;Tolstoy&quot;);
 
$author-&gt;save();
// teraz możesz pobrać jego primary key (ID)
$author_id = $author-&gt;getId();</pre>

<h3>Wstawianie &quot;Kaskadowe&quot;</h3>
<p>W przykładzie powyżej, wstawiliśmy pojedynczy wiersz do tabeli. W wielu przypadkach bedziesz miał jednak do czynienia z powiązanymi ze sobą rekordami - pojedynczy <strong>save()</strong> może zapisać więcej niż jeden rekord do bazy danych.</p>
<pre title="retrieveByPk() simple key">
// Stwórz Autora
$author = new Author();
$author-&gt;setFirstName(&quot;John&quot;);
$author-&gt;setLastName(&quot;Smith&quot;);
 
// Stwórz Publicyste
$publisher = new Publisher();
$publisher-&gt;setName(&quot;Penguin&quot;);

// Stwórz książkę J.Smitha
$book = new Book();
$book-&gt;setISBN(&quot;111-2222-3333&quot;);
$book-&gt;setTitle(&quot;Fake Title&quot;);
$book-&gt;setPublisher($publisher);
$book-&gt;setAuthor($author);

// Zapisanie obiektu book spowoduje zapisanie
// obiektów author i publisher
$book-&gt;save(); // doda 3 rekordy do bazy danych</pre>
<p>To najprostszy sposób pozwalający dodać (zapisać w bazie) obiekty automatycznie, gdy powiązany z nimi obiekt jest zapisywany. Możesz też ręcznie ustawić klucze obce, co w tym wypadku oznacza dodanie kilku linijek do powyższego kodu:</p>
<pre title="INSERT: manual fkey setting">
// Create Author
$author = new Author();
$author-&gt;setFirstName(&quot;John&quot;);
$author-&gt;setLastName(&quot;Smith&quot;);
$author-&gt;save();
 .
 .
$book = new Book();
$book-&gt;setAuthorId($author-&gt;getId());
 .
 .</pre>
<h2><a name="ManipulatingObjects.Updating"></a>Aktualizowanie Obiektów</h2>

<p>Prosta aktualizacja jest dokonywana, gdy obiekt zostanie zmodyfikowany poprzez użycie metod tzw. "setterów" (set*()) i wywołaniu metody <strong>save()</strong>. Kod wygląda podobnie jak kod odpowiadający za wstawianie nowych rekordów z ta różnicą, że klucz główny (primary key) jest juz ustawiony (w praktyce trzeba go pobrać z bazy).</p>

<pre title="Criteria: simple">
$obj = AuthorPeer::retrieveByPK(1); // pobierz autora o primary key = 1
$obj-&gt;setFirstName($obj-&gt;getFirstName() . &quot;-modiified&quot;);
$obj-&gt;save();  // Zapisz
 
// UPDATE author 
//        SET author.FIRST_NAME = '&quot;.$obj-&gt;getFirstName().&quot;-modified' 
//        WHERE author.AUTHOR_ID = 1
</pre>
<h2><a name="ManipulatingObjects.Deleting"></a>Usuwanie Obiektów</h2>

<p>Aby usunąć obiekt, a w konsekwencji rekord z bazy - wywołaj jego metodę <strong>delete()</strong> lub użyj metody  <strong>*Peer::doDelete()</strong></p>
<p>Metoda <strong>delete()</strong> usuwa obiekt z bazy identyfikując go po kluczu głównym (primary key). Obiekt z kolei otrzymuje status &quot;delete&quot;. Nadal możesz pobrać właściwości obiektu, ale nie możesz go już zapisać..</p>
<pre title="Using Object->delete()">$author = AuthorPeer::retrieveByPk(1);
$author-&gt;delete();

// DELETE FROM author WHERE author.AUTHOR_ID = 1</pre>

<p>Gdy używasz metody Peer <strong>doDelete()</strong>, możesz określić kryteria  wg. jakoch zostaną usunięte obiekty. W tym przykładzie usuniemy pojedynczy rekord z tabeli <em>author</em>.</p>

<pre title="Using Peer::doDelete()">$crit = new Criteria();
$crit-&gt;add(AuthorPeer::AUTHOR_ID, 1);
AuthorPeer::doDelete($crit);
// DELETE FROM author WHERE author.AUTHOR_ID = 1</pre>
 

<p>Propel wspiera również kaskadowe usuwanie rekordów (właczając w to bazy danych, które tego nie wspierają - Propel emuluje wówczas ten proces). Więcej na ten temat w rozdziale Relacje -  [<a href="Relationships.html#Relationships.CascadingDelete">Usuwanie Kaskadowe</a>].</p>
<p>&nbsp;</p>
</body>
</html>
